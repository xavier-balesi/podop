
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.14">
    
    
      
        <title>Reference - foobartory</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.10ba22f1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Open Sans";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="foobartory" class="md-header__button md-logo" aria-label="foobartory" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            foobartory
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/phptib/foobartory" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="foobartory" class="md-nav__button md-logo" aria-label="foobartory" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    foobartory
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/phptib/foobartory" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#back" class="md-nav__link">
    <span class="md-ellipsis">
      back
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.__main__" class="md-nav__link">
    <span class="md-ellipsis">
      __main__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__main__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.__main__.MultiServer" class="md-nav__link">
    <span class="md-ellipsis">
      MultiServer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MultiServer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.__main__.MultiServer.async_run" class="md-nav__link">
    <span class="md-ellipsis">
      async_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.__main__.MultiServer.shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      shutdown
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.__main__.cancel_all_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      cancel_all_tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.__main__.exit_application" class="md-nav__link">
    <span class="md-ellipsis">
      exit_application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.__main__.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.api" class="md-nav__link">
    <span class="md-ellipsis">
      api
    </span>
  </a>
  
    <nav class="md-nav" aria-label="api">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.api.monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      monitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.api.monitoring.healthcheck" class="md-nav__link">
    <span class="md-ellipsis">
      healthcheck
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.api.routes" class="md-nav__link">
    <span class="md-ellipsis">
      routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.api.routes.websocket_endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      websocket_endpoint
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.config.ApiConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ApiConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.config.ApplicationConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ApplicationConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.config.CamelBaseModel" class="md-nav__link">
    <span class="md-ellipsis">
      CamelBaseModel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.config.GameConfig" class="md-nav__link">
    <span class="md-ellipsis">
      GameConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.config.to_lower_camel_case" class="md-nav__link">
    <span class="md-ellipsis">
      to_lower_camel_case
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.controllers" class="md-nav__link">
    <span class="md-ellipsis">
      controllers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="controllers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.controllers.game" class="md-nav__link">
    <span class="md-ellipsis">
      game
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.game_stats_mixin" class="md-nav__link">
    <span class="md-ellipsis">
      game_stats_mixin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.player" class="md-nav__link">
    <span class="md-ellipsis">
      player
    </span>
  </a>
  
    <nav class="md-nav" aria-label="player">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.controllers.player.Player" class="md-nav__link">
    <span class="md-ellipsis">
      Player
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.player.RandomStrategyPlayer" class="md-nav__link">
    <span class="md-ellipsis">
      RandomStrategyPlayer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RandomStrategyPlayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.controllers.player.RandomStrategyPlayer.destroy" class="md-nav__link">
    <span class="md-ellipsis">
      destroy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.player.RandomStrategyPlayer.trade_in_live" class="md-nav__link">
    <span class="md-ellipsis">
      trade_in_live
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.robot" class="md-nav__link">
    <span class="md-ellipsis">
      robot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.trading_resource_game" class="md-nav__link">
    <span class="md-ellipsis">
      trading_resource_game
    </span>
  </a>
  
    <nav class="md-nav" aria-label="trading_resource_game">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.controllers.trading_resource_game.TradingResourceGame" class="md-nav__link">
    <span class="md-ellipsis">
      TradingResourceGame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TradingResourceGame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.controllers.trading_resource_game.TradingResourceGame.on_new_transaction" class="md-nav__link">
    <span class="md-ellipsis">
      on_new_transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.models.errors" class="md-nav__link">
    <span class="md-ellipsis">
      errors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="errors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.models.errors.GameError" class="md-nav__link">
    <span class="md-ellipsis">
      GameError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.models.errors.RobotBusyError" class="md-nav__link">
    <span class="md-ellipsis">
      RobotBusyError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.models.errors.SellError" class="md-nav__link">
    <span class="md-ellipsis">
      SellError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.models.inventory" class="md-nav__link">
    <span class="md-ellipsis">
      inventory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inventory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.models.inventory.Inventory" class="md-nav__link">
    <span class="md-ellipsis">
      Inventory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.models.ressources" class="md-nav__link">
    <span class="md-ellipsis">
      ressources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ressources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.models.ressources.BaseRessource" class="md-nav__link">
    <span class="md-ellipsis">
      BaseRessource
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseRessource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.models.ressources.BaseRessource.__init_subclass__" class="md-nav__link">
    <span class="md-ellipsis">
      __init_subclass__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.models.transaction" class="md-nav__link">
    <span class="md-ellipsis">
      transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.patterns" class="md-nav__link">
    <span class="md-ellipsis">
      patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.patterns.publish_subscribe" class="md-nav__link">
    <span class="md-ellipsis">
      publish_subscribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="publish_subscribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.patterns.publish_subscribe.Provider" class="md-nav__link">
    <span class="md-ellipsis">
      Provider
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.scheduler" class="md-nav__link">
    <span class="md-ellipsis">
      scheduler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scheduler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.scheduler.Scheduler" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scheduler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.scheduler.Scheduler.from_timestamp_contextmanager" class="md-nav__link">
    <span class="md-ellipsis">
      from_timestamp_contextmanager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.scheduler.Scheduler.from_timestamp_decorator" class="md-nav__link">
    <span class="md-ellipsis">
      from_timestamp_decorator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#back" class="md-nav__link">
    <span class="md-ellipsis">
      back
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.__main__" class="md-nav__link">
    <span class="md-ellipsis">
      __main__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__main__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.__main__.MultiServer" class="md-nav__link">
    <span class="md-ellipsis">
      MultiServer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MultiServer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.__main__.MultiServer.async_run" class="md-nav__link">
    <span class="md-ellipsis">
      async_run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.__main__.MultiServer.shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      shutdown
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.__main__.cancel_all_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      cancel_all_tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.__main__.exit_application" class="md-nav__link">
    <span class="md-ellipsis">
      exit_application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.__main__.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.api" class="md-nav__link">
    <span class="md-ellipsis">
      api
    </span>
  </a>
  
    <nav class="md-nav" aria-label="api">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.api.monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      monitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.api.monitoring.healthcheck" class="md-nav__link">
    <span class="md-ellipsis">
      healthcheck
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.api.routes" class="md-nav__link">
    <span class="md-ellipsis">
      routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.api.routes.websocket_endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      websocket_endpoint
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.config.ApiConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ApiConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.config.ApplicationConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ApplicationConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.config.CamelBaseModel" class="md-nav__link">
    <span class="md-ellipsis">
      CamelBaseModel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.config.GameConfig" class="md-nav__link">
    <span class="md-ellipsis">
      GameConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.config.to_lower_camel_case" class="md-nav__link">
    <span class="md-ellipsis">
      to_lower_camel_case
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.controllers" class="md-nav__link">
    <span class="md-ellipsis">
      controllers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="controllers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.controllers.game" class="md-nav__link">
    <span class="md-ellipsis">
      game
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.game_stats_mixin" class="md-nav__link">
    <span class="md-ellipsis">
      game_stats_mixin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.player" class="md-nav__link">
    <span class="md-ellipsis">
      player
    </span>
  </a>
  
    <nav class="md-nav" aria-label="player">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.controllers.player.Player" class="md-nav__link">
    <span class="md-ellipsis">
      Player
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.player.RandomStrategyPlayer" class="md-nav__link">
    <span class="md-ellipsis">
      RandomStrategyPlayer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RandomStrategyPlayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.controllers.player.RandomStrategyPlayer.destroy" class="md-nav__link">
    <span class="md-ellipsis">
      destroy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.player.RandomStrategyPlayer.trade_in_live" class="md-nav__link">
    <span class="md-ellipsis">
      trade_in_live
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.robot" class="md-nav__link">
    <span class="md-ellipsis">
      robot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.controllers.trading_resource_game" class="md-nav__link">
    <span class="md-ellipsis">
      trading_resource_game
    </span>
  </a>
  
    <nav class="md-nav" aria-label="trading_resource_game">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.controllers.trading_resource_game.TradingResourceGame" class="md-nav__link">
    <span class="md-ellipsis">
      TradingResourceGame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TradingResourceGame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.controllers.trading_resource_game.TradingResourceGame.on_new_transaction" class="md-nav__link">
    <span class="md-ellipsis">
      on_new_transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.models.errors" class="md-nav__link">
    <span class="md-ellipsis">
      errors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="errors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.models.errors.GameError" class="md-nav__link">
    <span class="md-ellipsis">
      GameError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.models.errors.RobotBusyError" class="md-nav__link">
    <span class="md-ellipsis">
      RobotBusyError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.models.errors.SellError" class="md-nav__link">
    <span class="md-ellipsis">
      SellError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.models.inventory" class="md-nav__link">
    <span class="md-ellipsis">
      inventory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inventory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.models.inventory.Inventory" class="md-nav__link">
    <span class="md-ellipsis">
      Inventory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.models.ressources" class="md-nav__link">
    <span class="md-ellipsis">
      ressources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ressources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.models.ressources.BaseRessource" class="md-nav__link">
    <span class="md-ellipsis">
      BaseRessource
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseRessource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.models.ressources.BaseRessource.__init_subclass__" class="md-nav__link">
    <span class="md-ellipsis">
      __init_subclass__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.models.transaction" class="md-nav__link">
    <span class="md-ellipsis">
      transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.patterns" class="md-nav__link">
    <span class="md-ellipsis">
      patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.patterns.publish_subscribe" class="md-nav__link">
    <span class="md-ellipsis">
      publish_subscribe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="publish_subscribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.patterns.publish_subscribe.Provider" class="md-nav__link">
    <span class="md-ellipsis">
      Provider
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back.scheduler" class="md-nav__link">
    <span class="md-ellipsis">
      scheduler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="scheduler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.scheduler.Scheduler" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scheduler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#back.scheduler.Scheduler.from_timestamp_contextmanager" class="md-nav__link">
    <span class="md-ellipsis">
      from_timestamp_contextmanager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back.scheduler.Scheduler.from_timestamp_decorator" class="md-nav__link">
    <span class="md-ellipsis">
      from_timestamp_decorator
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/phptib/foobartory/blob/main/back/docs/reference.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/phptib/foobartory/raw/main/back/docs/reference.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">¤</a></h1>


<div class="doc doc-object doc-module">



<a id="back"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h2 id="back.__main__" class="doc doc-heading">
          <code>__main__</code>


<a href="#back.__main__" class="headerlink" title="Permanent link">¤</a></h2>

  <div class="doc doc-contents ">
  
      <p>Main module executed by the Dockerfile.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="back.__main__.MultiServer" class="doc doc-heading">
          <code>MultiServer</code>


<a href="#back.__main__.MultiServer" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="uvicorn.Server">Server</span></code></p>

  
      <p>Server listening on one port and accepting other servers in parallel.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/__main__.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MultiServer</span><span class="p">(</span><span class="n">Server</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Server listening on one port and accepting other servers in parallel.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on_shutdown</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_shutdown</span> <span class="o">=</span> <span class="n">on_shutdown</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">async_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sockets</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Same implementation as :meth:`~Server.run` but in async.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setup_event_loop</span><span class="p">()</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">sockets</span><span class="o">=</span><span class="n">sockets</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover (can only be called in prod)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shutdown the server and notify the others.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">()</span>
        <span class="n">cancel_all_tasks</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="back.__main__.MultiServer.async_run" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">async_run</span><span class="p">(</span><span class="n">sockets</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#back.__main__.MultiServer.async_run" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Same implementation as :meth:<code class="language-python highlight"><span class="o">~</span><span class="n">Server</span><span class="o">.</span><span class="n">run</span></code> but in async.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/__main__.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">async_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sockets</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Same implementation as :meth:`~Server.run` but in async.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setup_event_loop</span><span class="p">()</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">sockets</span><span class="o">=</span><span class="n">sockets</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="back.__main__.MultiServer.shutdown" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">shutdown</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#back.__main__.MultiServer.shutdown" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Shutdown the server and notify the others.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/__main__.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover (can only be called in prod)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shutdown the server and notify the others.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">()</span>
    <span class="n">cancel_all_tasks</span><span class="p">()</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h3 id="back.__main__.cancel_all_tasks" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">cancel_all_tasks</span><span class="p">(</span><span class="n">exclude_current</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#back.__main__.cancel_all_tasks" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
  
      <p>Cancel all asyncio tasks to force exiting on Ctrl+C.
Necessary only because of the game infinite loop.
TODO: find cleaner solution.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/__main__.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cancel_all_tasks</span><span class="p">(</span><span class="n">exclude_current</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cancel all asyncio tasks to force exiting on Ctrl+C.</span>
<span class="sd">    Necessary only because of the game infinite loop.</span>
<span class="sd">    TODO: find cleaner solution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_tasks</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">all_tasks</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">exclude_current</span> <span class="ow">and</span> <span class="p">(</span><span class="n">current_task</span> <span class="o">:=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">current_task</span><span class="p">()):</span>
        <span class="n">all_tasks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">current_task</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">all_tasks</span><span class="p">:</span>
        <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="back.__main__.exit_application" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">exit_application</span><span class="p">()</span></code>

<a href="#back.__main__.exit_application" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
  
      <p>Exit the application.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/__main__.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">exit_application</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exit the application.&quot;&quot;&quot;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;exiting the backend&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">:</span>
        <span class="n">server</span><span class="o">.</span><span class="n">should_exit</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="back.__main__.main" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#back.__main__.main" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
  
      <p>Main function executed by the Dockerfile.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/__main__.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main function executed by the Dockerfile.&quot;&quot;&quot;</span>
    <span class="n">app_config</span><span class="p">:</span> <span class="n">ApplicationConfig</span> <span class="o">=</span> <span class="n">ApplicationConfig</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">app</span><span class="p">,</span> <span class="n">port</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;back.api.routes:app&quot;</span><span class="p">,</span> <span class="n">api_port</span> <span class="o">:=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">port</span><span class="p">),</span>
        <span class="p">(</span>
            <span class="s2">&quot;back.api.monitoring:app&quot;</span><span class="p">,</span>
            <span class="n">monitoring_port</span> <span class="o">:=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">monitoring_port</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">):</span>
        <span class="c1"># WARNING: when providing the default log_config, it disabled all existing loggers, and we loose some logs.</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">log_config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">servers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MultiServer</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">on_shutdown</span><span class="o">=</span><span class="n">exit_application</span><span class="p">))</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;the backend is ready and listen on </span><span class="si">{</span><span class="n">api_port</span><span class="si">}</span><span class="s2"> (API) and </span><span class="si">{</span><span class="n">monitoring_port</span><span class="si">}</span><span class="s2"> (monitoring)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># By using a dedicated port for monitoring features (healthcheck, metrics, changing log level, etc.),</span>
    <span class="c1"># and not exposing it, the front can&#39;t have access to these features. It&#39;s more risky to expect</span>
    <span class="c1"># an API Gateway blocking the access to /monitoring path.</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">async_run</span><span class="p">()</span> <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="back.api" class="doc doc-heading">
          <code>api</code>


<a href="#back.api" class="headerlink" title="Permanent link">¤</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="back.api.monitoring" class="doc doc-heading">
          <code>monitoring</code>


<a href="#back.api.monitoring" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">
  
      <p>main module executed by the Dockerfile.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="back.api.monitoring.healthcheck" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">healthcheck</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#back.api.monitoring.healthcheck" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Healthcheck for Kubernetes.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/api/monitoring.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/monitoring/health&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">healthcheck</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Healthcheck for Kubernetes.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">200</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="back.api.routes" class="doc doc-heading">
          <code>routes</code>


<a href="#back.api.routes" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="back.api.routes.websocket_endpoint" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">websocket_endpoint</span><span class="p">(</span><span class="n">websocket</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#back.api.routes.websocket_endpoint" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Start a new game by connecting to a websocket.</p>
<p>The game runs as fast as possible. Eventually slow it down by using the <code class="language-python highlight"><span class="n">turn_interval</span></code> config.
Spying the game by sampling the game resources at a given framerate (see <code class="language-python highlight"><span class="n">framerate</span></code> config).
Game information are communicated in JSON format by a websocket.
A complete resource history is sent when the game is over.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/api/routes.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">websocket</span><span class="p">(</span><span class="s2">&quot;/ws&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">websocket_endpoint</span><span class="p">(</span><span class="n">websocket</span><span class="p">:</span> <span class="n">WebSocket</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start a new game by connecting to a websocket.</span>

<span class="sd">    The game runs as fast as possible. Eventually slow it down by using the `turn_interval` config.</span>
<span class="sd">    Spying the game by sampling the game resources at a given framerate (see `framerate` config).</span>
<span class="sd">    Game information are communicated in JSON format by a websocket.</span>
<span class="sd">    A complete resource history is sent when the game is over.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Client connected&quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
    <span class="n">game</span> <span class="o">=</span> <span class="n">Game</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">notify_front</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">game</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">api_config</span><span class="o">.</span><span class="n">framerate</span><span class="p">)</span>

            <span class="c1"># Sampling number of game resources on each frame.</span>
            <span class="n">front_msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Using a websocket to eventually pilot the trading strategy manually from the web client.</span>
                <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">send_text</span><span class="p">(</span><span class="n">front_msg</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">WebSocketDisconnect</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Client disconnected: </span><span class="si">{</span><span class="n">e</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># Send the complete resource history when the game is over.</span>
        <span class="n">counts_history</span><span class="p">:</span> <span class="n">CountsHistory</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">get_counts_history</span><span class="p">()</span>
        <span class="c1"># TODO: timeit orjson.dumps(model.dict(exclude_none=True))</span>
        <span class="n">front_msg</span> <span class="o">=</span> <span class="n">counts_history</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># We can also debug the backend without frontend by doing:</span>
        <span class="c1">#   python -m websockets &#39;ws://localhost:8080/ws&#39;</span>
        <span class="c1"># and displaying the desired data in color with:</span>
        <span class="c1">#   print_json(data=counts_history.dict(exclude_none=True))</span>
        <span class="c1"># from rich module, for example.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">websocket</span><span class="o">.</span><span class="n">send_text</span><span class="p">(</span><span class="n">front_msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">WebSocketDisconnect</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Client disconnected: </span><span class="si">{</span><span class="n">e</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="c1"># Run the game and spy the game in parallel, by sampling the inventory.</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">game</span><span class="o">.</span><span class="n">run</span><span class="p">(),</span> <span class="n">notify_front</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>


  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="back.config" class="doc doc-heading">
          <code>config</code>


<a href="#back.config" class="headerlink" title="Permanent link">¤</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="back.config.ApiConfig" class="doc doc-heading">
          <code>ApiConfig</code>


<a href="#back.config.ApiConfig" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="back.config.CamelBaseModel" href="#back.config.CamelBaseModel">CamelBaseModel</a></code></p>

  
      <p>HTTP servers configuration.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ApiConfig</span><span class="p">(</span><span class="n">CamelBaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HTTP servers configuration.&quot;&quot;&quot;</span>

    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8000</span>
    <span class="n">monitoring_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9000</span>
    <span class="n">framerate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span>
        <span class="c1"># Number of notification per second sent by the backend to the frontend.</span>
        <span class="c1"># Could be adapted according to the &quot;turn_interval&quot; parameter.</span>
        <span class="mi">30</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="back.config.ApplicationConfig" class="doc doc-heading">
          <code>ApplicationConfig</code>


<a href="#back.config.ApplicationConfig" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="back.config.CamelBaseModel" href="#back.config.CamelBaseModel">CamelBaseModel</a></code></p>

  
      <p>Application configuration.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ApplicationConfig</span><span class="p">(</span><span class="n">CamelBaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Application configuration.&quot;&quot;&quot;</span>

    <span class="n">api</span><span class="p">:</span> <span class="n">ApiConfig</span> <span class="o">=</span> <span class="n">ApiConfig</span><span class="p">()</span>
    <span class="n">game</span><span class="p">:</span> <span class="n">GameConfig</span> <span class="o">=</span> <span class="n">GameConfig</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="back.config.CamelBaseModel" class="doc doc-heading">
          <code>CamelBaseModel</code>


<a href="#back.config.CamelBaseModel" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>

  
      <p>Base model class to use the lower camel case like the other config files in the helmfiles.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CamelBaseModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base model class to use the lower camel case like the other config files in the helmfiles.&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>  <span class="c1"># pylint: disable=missing-class-docstring</span>
        <span class="n">alias_generator</span> <span class="o">=</span> <span class="n">to_lower_camel_case</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h3 id="back.config.GameConfig" class="doc doc-heading">
          <code>GameConfig</code>


<a href="#back.config.GameConfig" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="back.config.CamelBaseModel" href="#back.config.CamelBaseModel">CamelBaseModel</a></code></p>

  
      <p>Game configuration.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GameConfig</span><span class="p">(</span><span class="n">CamelBaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Game configuration.&quot;&quot;&quot;</span>

    <span class="c1"># Using ints to avoid float precision errors (using decimal module is less direct).</span>
    <span class="n">move_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5000</span>  <span class="c1"># in ms</span>
    <span class="n">mine_foo_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># in ms</span>
    <span class="n">mine_bar_duration_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># in ms</span>
    <span class="n">mine_bar_duration_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span>  <span class="c1"># in ms</span>
    <span class="n">forge_foobar_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span>  <span class="c1"># in ms</span>
    <span class="n">forge_foobar_success_rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c1"># in percent</span>
    <span class="n">sell_foobar_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># in ms</span>
    <span class="n">sell_foobar_max_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">money_for_foobar</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># in euros</span>
    <span class="n">buy_robot_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># in ms</span>
    <span class="n">money_for_robot</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># number of euros to buy a robot</span>
    <span class="n">foo_for_robot</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span>  <span class="c1"># number of foo to buy a robot</span>
    <span class="n">min_robots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># the game starts with this number of robots</span>
    <span class="n">max_robots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># the game ends when reaching this number of robots</span>
    <span class="n">turn_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">10</span>  <span class="c1"># duration of one turn in ms, the scheduler jump with this duration</span>
    <span class="p">)</span>
    <span class="n">turn_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">0</span>  <span class="c1"># interval between turns in ms, increase to slow down the game</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h3 id="back.config.to_lower_camel_case" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">to_lower_camel_case</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></code>

<a href="#back.config.to_lower_camel_case" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">
  
      <p>Return the lower camel case version of the input string as used in helmfiles.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/config.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_lower_camel_case</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the lower camel case version of the input string as used in helmfiles.&quot;&quot;&quot;</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="back.controllers" class="doc doc-heading">
          <code>controllers</code>


<a href="#back.controllers" class="headerlink" title="Permanent link">¤</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="back.controllers.game" class="doc doc-heading">
          <code>game</code>


<a href="#back.controllers.game" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="back.controllers.game_stats_mixin" class="doc doc-heading">
          <code>game_stats_mixin</code>


<a href="#back.controllers.game_stats_mixin" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="back.controllers.player" class="doc doc-heading">
          <code>player</code>


<a href="#back.controllers.player" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="back.controllers.player.Player" class="doc doc-heading">
          <code>Player</code>


<a href="#back.controllers.player.Player" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">

  
      <p>Mining gamer or trader, that is the question.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/controllers/player.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Player</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mining gamer or trader, that is the question.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  </div>


</div>

<div class="doc doc-object doc-class">



<h4 id="back.controllers.player.RandomStrategyPlayer" class="doc doc-heading">
          <code>RandomStrategyPlayer</code>


<a href="#back.controllers.player.RandomStrategyPlayer" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="back.controllers.player.Player" href="#back.controllers.player.Player">Player</a></code></p>

  
      <p>Player that plays randomly.
Many random games might help finding good strategies.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/controllers/player.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RandomStrategyPlayer</span><span class="p">(</span><span class="n">Player</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Player that plays randomly.</span>
<span class="sd">    Many random games might help finding good strategies.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_game&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">:</span> <span class="s2">&quot;Game&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_game</span><span class="p">:</span> <span class="n">Game</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">game</span>

    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Destructor method.</span>

<span class="sd">        Not using __del__ because it notifies when the object is garbage collected,</span>
<span class="sd">        but it may not be called with cyclic references. It&#39;s not deterministic, so it&#39;s not</span>
<span class="sd">        compatible to avoid memory leaks.</span>
<span class="sd">        In cpython, __del__ is in practice called when there is no more reference to the object,</span>
<span class="sd">        but with PyPy it&#39;s delayed for performances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_game</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">trade_in_live</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Play each time the game changes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">game</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_game</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The game is detached fom the player.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">inventory</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">get_inventory</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="n">inventory</span><span class="o">.</span><span class="n">robots</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">robot</span><span class="o">.</span><span class="n">action</span> <span class="o">!=</span> <span class="n">Action</span><span class="o">.</span><span class="n">WAITING_FOR_ORDER</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># It&#39;s always possible to mine foo or bar.</span>
            <span class="n">possible_actions</span> <span class="o">=</span> <span class="p">[</span><span class="n">robot</span><span class="o">.</span><span class="n">mine_foo</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">mine_bar</span><span class="p">]</span>

            <span class="c1"># Can we forge a foobar?</span>
            <span class="k">if</span> <span class="n">inventory</span><span class="o">.</span><span class="n">get_foo</span><span class="p">(</span><span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">inventory</span><span class="o">.</span><span class="n">get_bar</span><span class="p">(</span><span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
                <span class="n">possible_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">forge_foobar</span><span class="p">)</span>

            <span class="c1"># Can we sell a random count of foobar?</span>
            <span class="n">sell_count</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">game_config</span><span class="o">.</span><span class="n">sell_foobar_max_count</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inventory</span><span class="o">.</span><span class="n">get_foobars</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">sell_count</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
                <span class="n">possible_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">sell_foobar</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">sell_count</span><span class="p">))</span>

            <span class="c1"># Can we buy a robot?</span>
            <span class="k">if</span> <span class="n">inventory</span><span class="o">.</span><span class="n">money</span> <span class="o">&gt;=</span> <span class="n">game_config</span><span class="o">.</span><span class="n">money_for_robot</span> <span class="ow">and</span> <span class="n">inventory</span><span class="o">.</span><span class="n">get_foos</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
                <span class="n">count</span><span class="o">=</span><span class="n">game_config</span><span class="o">.</span><span class="n">foo_for_robot</span><span class="p">,</span>
                <span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">possible_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">buy_robot</span><span class="p">)</span>

            <span class="c1"># Choose a random action that respect game rules.</span>
            <span class="n">random_action</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">possible_actions</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;player choose </span><span class="si">{</span><span class="n">random_action</span><span class="si">}</span><span class="s2"> while </span><span class="si">{</span><span class="n">game</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">random_action</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h5 id="back.controllers.player.RandomStrategyPlayer.destroy" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">destroy</span><span class="p">()</span></code>

<a href="#back.controllers.player.RandomStrategyPlayer.destroy" class="headerlink" title="Permanent link">¤</a></h5>


  <div class="doc doc-contents ">
  
      <p>Destructor method.</p>
<p>Not using <strong>del</strong> because it notifies when the object is garbage collected,
but it may not be called with cyclic references. It's not deterministic, so it's not
compatible to avoid memory leaks.
In cpython, <strong>del</strong> is in practice called when there is no more reference to the object,
but with PyPy it's delayed for performances.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/controllers/player.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Destructor method.</span>

<span class="sd">    Not using __del__ because it notifies when the object is garbage collected,</span>
<span class="sd">    but it may not be called with cyclic references. It&#39;s not deterministic, so it&#39;s not</span>
<span class="sd">    compatible to avoid memory leaks.</span>
<span class="sd">    In cpython, __del__ is in practice called when there is no more reference to the object,</span>
<span class="sd">    but with PyPy it&#39;s delayed for performances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_game</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="back.controllers.player.RandomStrategyPlayer.trade_in_live" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">trade_in_live</span><span class="p">()</span></code>

<a href="#back.controllers.player.RandomStrategyPlayer.trade_in_live" class="headerlink" title="Permanent link">¤</a></h5>


  <div class="doc doc-contents ">
  
      <p>Play each time the game changes.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/controllers/player.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">trade_in_live</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Play each time the game changes.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">game</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_game</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The game is detached fom the player.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">inventory</span> <span class="o">=</span> <span class="n">game</span><span class="o">.</span><span class="n">get_inventory</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">robot</span> <span class="ow">in</span> <span class="n">inventory</span><span class="o">.</span><span class="n">robots</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">robot</span><span class="o">.</span><span class="n">action</span> <span class="o">!=</span> <span class="n">Action</span><span class="o">.</span><span class="n">WAITING_FOR_ORDER</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># It&#39;s always possible to mine foo or bar.</span>
        <span class="n">possible_actions</span> <span class="o">=</span> <span class="p">[</span><span class="n">robot</span><span class="o">.</span><span class="n">mine_foo</span><span class="p">,</span> <span class="n">robot</span><span class="o">.</span><span class="n">mine_bar</span><span class="p">]</span>

        <span class="c1"># Can we forge a foobar?</span>
        <span class="k">if</span> <span class="n">inventory</span><span class="o">.</span><span class="n">get_foo</span><span class="p">(</span><span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">inventory</span><span class="o">.</span><span class="n">get_bar</span><span class="p">(</span><span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
            <span class="n">possible_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">forge_foobar</span><span class="p">)</span>

        <span class="c1"># Can we sell a random count of foobar?</span>
        <span class="n">sell_count</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">game_config</span><span class="o">.</span><span class="n">sell_foobar_max_count</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inventory</span><span class="o">.</span><span class="n">get_foobars</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">sell_count</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
            <span class="n">possible_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">sell_foobar</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">sell_count</span><span class="p">))</span>

        <span class="c1"># Can we buy a robot?</span>
        <span class="k">if</span> <span class="n">inventory</span><span class="o">.</span><span class="n">money</span> <span class="o">&gt;=</span> <span class="n">game_config</span><span class="o">.</span><span class="n">money_for_robot</span> <span class="ow">and</span> <span class="n">inventory</span><span class="o">.</span><span class="n">get_foos</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="n">count</span><span class="o">=</span><span class="n">game_config</span><span class="o">.</span><span class="n">foo_for_robot</span><span class="p">,</span>
            <span class="n">lock</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">possible_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">robot</span><span class="o">.</span><span class="n">buy_robot</span><span class="p">)</span>

        <span class="c1"># Choose a random action that respect game rules.</span>
        <span class="n">random_action</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">possible_actions</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;player choose </span><span class="si">{</span><span class="n">random_action</span><span class="si">}</span><span class="s2"> while </span><span class="si">{</span><span class="n">game</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">random_action</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="back.controllers.robot" class="doc doc-heading">
          <code>robot</code>


<a href="#back.controllers.robot" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="back.controllers.trading_resource_game" class="doc doc-heading">
          <code>trading_resource_game</code>


<a href="#back.controllers.trading_resource_game" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="back.controllers.trading_resource_game.TradingResourceGame" class="doc doc-heading">
          <code>TradingResourceGame</code>


<a href="#back.controllers.trading_resource_game.TradingResourceGame" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">

  
      <p>Interface for a trading resource game.</p>
<p>NB: Trading resources generates transactions.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/controllers/trading_resource_game.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TradingResourceGame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface for a trading resource game.</span>

<span class="sd">    NB: Trading resources generates transactions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span><span class="p">:</span> <span class="n">Inventory</span> <span class="o">=</span> <span class="n">Inventory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Transactions are like &quot;gold source&quot; outputs of the game.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Transaction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Inventory</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span>

    <span class="k">def</span> <span class="nf">on_new_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The game is notified when a transaction of resources happens.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h5 id="back.controllers.trading_resource_game.TradingResourceGame.on_new_transaction" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">on_new_transaction</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span></code>

<a href="#back.controllers.trading_resource_game.TradingResourceGame.on_new_transaction" class="headerlink" title="Permanent link">¤</a></h5>


  <div class="doc doc-contents ">
  
      <p>The game is notified when a transaction of resources happens.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/controllers/trading_resource_game.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">on_new_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The game is notified when a transaction of resources happens.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_transactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>


  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="back.models" class="doc doc-heading">
          <code>models</code>


<a href="#back.models" class="headerlink" title="Permanent link">¤</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="back.models.errors" class="doc doc-heading">
          <code>errors</code>


<a href="#back.models.errors" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="back.models.errors.GameError" class="doc doc-heading">
          <code>GameError</code>


<a href="#back.models.errors.GameError" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code>Exception</code></p>

  
      <p>Base class for Foobartory exceptions.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/models/errors.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GameError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for Foobartory exceptions.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  </div>


</div>

<div class="doc doc-object doc-class">



<h4 id="back.models.errors.RobotBusyError" class="doc doc-heading">
          <code>RobotBusyError</code>


<a href="#back.models.errors.RobotBusyError" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="back.models.errors.GameError" href="#back.models.errors.GameError">GameError</a></code></p>

  
      <p>The robot cannot do anything for now.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/models/errors.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RobotBusyError</span><span class="p">(</span><span class="n">GameError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The robot cannot do anything for now.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  </div>


</div>

<div class="doc doc-object doc-class">



<h4 id="back.models.errors.SellError" class="doc doc-heading">
          <code>SellError</code>


<a href="#back.models.errors.SellError" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="back.models.errors.GameError" href="#back.models.errors.GameError">GameError</a></code></p>

  
      <p>Error while selling foobars.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/models/errors.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SellError</span><span class="p">(</span><span class="n">GameError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error while selling foobars.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="back.models.inventory" class="doc doc-heading">
          <code>inventory</code>


<a href="#back.models.inventory" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="back.models.inventory.Inventory" class="doc doc-heading">
          <code>Inventory</code>


<a href="#back.models.inventory.Inventory" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">

  
      <p>Inventory of all game data models.
Act as the :class:<code class="language-python highlight"><span class="o">~</span><span class="n">back</span><span class="o">.</span><span class="n">controllers</span><span class="o">.</span><span class="n">Game</span></code> data model.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/models/inventory.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Inventory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inventory of all game data models.</span>
<span class="sd">    Act as the :class:`~back.controllers.Game` data model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Complete class methods.</span>
        <span class="k">for</span> <span class="n">ressource_name</span> <span class="ow">in</span> <span class="n">IncrIdRessources</span><span class="o">.</span><span class="n">__args__</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="n">ressource_name</span> <span class="o">=</span> <span class="n">ressource_name</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="s2">&quot;get_&quot;</span> <span class="o">+</span> <span class="n">ressource_name</span><span class="p">,</span>
                <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ressource</span><span class="p">,</span> <span class="n">ressource_name</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;get_</span><span class="si">{</span><span class="n">ressource_name</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span>
                <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ressources</span><span class="p">,</span> <span class="n">ressource_name</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># Populate the inventory with default values.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">money</span> <span class="o">=</span> <span class="n">Money</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foos</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Foo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bars</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Bar</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foobars</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FooBar</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Robot</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Robot</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">inventory</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">game_config</span><span class="o">.</span><span class="n">min_robots</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Inventory(foos=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foos</span><span class="p">)</span><span class="si">}</span><span class="s2">, bars=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bars</span><span class="p">)</span><span class="si">}</span><span class="s2">, foobars=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foobars</span><span class="p">)</span><span class="si">}</span><span class="s2">, robots=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="p">)</span><span class="si">}</span><span class="s2">, money=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">money</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">get_ressource</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ressource_name</span><span class="p">:</span> <span class="n">IncrIdRessources</span><span class="p">,</span>
        <span class="n">lock</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IncrIdRessources</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ressources</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ressource_name</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">for</span> <span class="n">ressource</span> <span class="ow">in</span> <span class="n">ressources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ressource</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">lock</span><span class="p">:</span>
                <span class="n">ressource</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">ressource</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_ressources</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ressource_name</span><span class="p">:</span> <span class="n">IncrIdRessources</span><span class="p">,</span>
        <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">lock</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">IncrIdRessources</span><span class="p">]:</span>
        <span class="n">returned_ressources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ressources</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ressource_name</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">for</span> <span class="n">ressource</span> <span class="ow">in</span> <span class="n">ressources</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ressource</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">lock</span><span class="p">:</span>
                <span class="n">ressource</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">returned_ressources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ressource</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">returned_ressources</span><span class="p">)</span> <span class="o">==</span> <span class="n">count</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Revert the lock when the count is not there.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">returned_ressources</span><span class="p">)</span> <span class="o">!=</span> <span class="n">count</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ressource</span> <span class="ow">in</span> <span class="n">returned_ressources</span><span class="p">:</span>
                <span class="n">ressource</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">returned_ressources</span>

    <span class="k">def</span> <span class="nf">on_new_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">:</span> <span class="n">Transaction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">transaction</span><span class="o">.</span><span class="n">add</span><span class="p">:</span>
            <span class="k">match</span> <span class="n">model</span><span class="p">:</span>
                <span class="k">case</span> <span class="n">Foo</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">foos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">case</span> <span class="n">Bar</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">case</span> <span class="n">FooBar</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">foobars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">case</span> <span class="n">Robot</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">case</span> <span class="n">Money</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">money</span> <span class="o">+=</span> <span class="n">model</span>

        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">transaction</span><span class="o">.</span><span class="n">remove</span><span class="p">:</span>
            <span class="k">match</span> <span class="n">model</span><span class="p">:</span>
                <span class="k">case</span> <span class="n">Foo</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">foos</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">case</span> <span class="n">Bar</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bars</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">case</span> <span class="n">FooBar</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">foobars</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">case</span> <span class="n">Robot</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">robots</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">case</span> <span class="n">Money</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">money</span> <span class="o">-=</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="back.models.ressources" class="doc doc-heading">
          <code>ressources</code>


<a href="#back.models.ressources" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="back.models.ressources.BaseRessource" class="doc doc-heading">
          <code>BaseRessource</code>


<a href="#back.models.ressources.BaseRessource" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>

  
      <p>Base data model that can be listed in :class:<code class="language-python highlight"><span class="o">~</span><span class="n">back</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">transaction</span><span class="o">.</span><span class="n">Transaction</span></code>.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/models/ressources.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseRessource</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base data model that can be listed in :class:`~back.models.transaction.Transaction`.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Avoid having the error: &quot;Unable to extract tag using discriminator &#39;type&#39;&quot;</span>
<span class="sd">        at runtime. We directly see the problem at import time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># __init_subclass__ avoid having to use a metaclass in this use case</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The class </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> must have a &#39;type&#39; field.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h5 id="back.models.ressources.BaseRessource.__init_subclass__" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#back.models.ressources.BaseRessource.__init_subclass__" class="headerlink" title="Permanent link">¤</a></h5>


  <div class="doc doc-contents ">
  
      <p>Avoid having the error: "Unable to extract tag using discriminator 'type'"
at runtime. We directly see the problem at import time.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/models/ressources.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Avoid having the error: &quot;Unable to extract tag using discriminator &#39;type&#39;&quot;</span>
<span class="sd">    at runtime. We directly see the problem at import time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># __init_subclass__ avoid having to use a metaclass in this use case</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The class </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> must have a &#39;type&#39; field.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="back.models.transaction" class="doc doc-heading">
          <code>transaction</code>


<a href="#back.models.transaction" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">











  </div>

  </div>

</div>


  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="back.patterns" class="doc doc-heading">
          <code>patterns</code>


<a href="#back.patterns" class="headerlink" title="Permanent link">¤</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="back.patterns.publish_subscribe" class="doc doc-heading">
          <code>publish_subscribe</code>


<a href="#back.patterns.publish_subscribe" class="headerlink" title="Permanent link">¤</a></h3>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="back.patterns.publish_subscribe.Provider" class="doc doc-heading">
          <code>Provider</code>


<a href="#back.patterns.publish_subscribe.Provider" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">

  
      <p>Implementation of the Publish-Subscribe conversation pattern.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/patterns/publish_subscribe.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Provider</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementation of the Publish-Subscribe conversation pattern.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
            <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;EventType&quot;</span><span class="p">],</span>
            <span class="nb">list</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="s2">&quot;EventType&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]],</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;EventType&quot;</span><span class="p">],</span>
        <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="s2">&quot;EventType&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="p">[</span><span class="n">event_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unsubscribe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;EventType&quot;</span><span class="p">],</span>
        <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="s2">&quot;EventType&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="p">[</span><span class="n">event_type</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="s2">&quot;EventType&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observers</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">event</span><span class="p">)]:</span>
            <span class="n">handler</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>




  </div>

  </div>

</div>


  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="back.scheduler" class="doc doc-heading">
          <code>scheduler</code>


<a href="#back.scheduler" class="headerlink" title="Permanent link">¤</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="back.scheduler.Scheduler" class="doc doc-heading">
          <code>Scheduler</code>


<a href="#back.scheduler.Scheduler" class="headerlink" title="Permanent link">¤</a></h3>


  <div class="doc doc-contents ">

  
      <p>The game scheduler is not based on real timestamps, real delays, allowing for the scheduling of the next game turn
directly after the previous one. Indeed, the primary objective of the game appears to be the construction of a
trading model (using algorithms or machine learning), and the more parties we run, the better.</p>

            <details class="quote">
              <summary>Source code in <code>src/back/scheduler.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Scheduler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The game scheduler is not based on real timestamps, real delays, allowing for the scheduling of the next game turn</span>
<span class="sd">    directly after the previous one. Indeed, the primary objective of the game appears to be the construction of a</span>
<span class="sd">    trading model (using algorithms or machine learning), and the more parties we run, the better.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ts&quot;</span><span class="p">,</span> <span class="s2">&quot;_tasks&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># heapq is not thread safe and then, more optimal than synchronisation queues (sync or async)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Task</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">scheduleabs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">simplified_action</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="p">,</span> <span class="n">Task</span><span class="p">(</span><span class="n">start_ts</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">simplified_action</span><span class="p">))</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;scheduling at </span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> action </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2"> with args=</span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2"> and kwargs=</span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">+</span> <span class="n">delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduleabs</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># log.debug(f&quot;now at {timestamp}&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span> <span class="ow">and</span> <span class="p">(</span><span class="n">action_ts</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_ts</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;executing action planned for </span><span class="si">{</span><span class="n">action_ts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">task</span><span class="p">:</span> <span class="n">Task</span> <span class="o">=</span> <span class="n">heappop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="p">)</span>
            <span class="n">task</span><span class="o">.</span><span class="n">action</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">jump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">+</span> <span class="n">delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_timestamp</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;resetting scheduler&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">from_timestamp_contextmanager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Permit to change the now timestamp with a contextmanager.</span>
<span class="sd">        so that child schedules do not depend on future time shifting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">orig_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="c1"># change now timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># restore now timestamp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">orig_ts</span>

    <span class="k">def</span> <span class="nf">from_timestamp_decorator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Permit to change the now timestamp with a decorator</span>
<span class="sd">        so that child schedules do not depend on future time shifting.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_from_timestamp_decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">_from_timestamp_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_timestamp_contextmanager</span><span class="p">(</span><span class="n">ts</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">_from_timestamp_wrapper</span>

        <span class="k">return</span> <span class="n">_from_timestamp_decorator</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">busy_until</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start_ts</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h4 id="back.scheduler.Scheduler.from_timestamp_contextmanager" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">from_timestamp_contextmanager</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span></code>

<a href="#back.scheduler.Scheduler.from_timestamp_contextmanager" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Permit to change the now timestamp with a contextmanager.
so that child schedules do not depend on future time shifting.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/scheduler.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">from_timestamp_contextmanager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Permit to change the now timestamp with a contextmanager.</span>
<span class="sd">    so that child schedules do not depend on future time shifting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">orig_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
    <span class="c1"># change now timestamp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># restore now timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">orig_ts</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h4 id="back.scheduler.Scheduler.from_timestamp_decorator" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">from_timestamp_decorator</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span></code>

<a href="#back.scheduler.Scheduler.from_timestamp_decorator" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
  
      <p>Permit to change the now timestamp with a decorator
so that child schedules do not depend on future time shifting.</p>

          <details class="quote">
            <summary>Source code in <code>src/back/scheduler.py</code></summary>
            <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_timestamp_decorator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Permit to change the now timestamp with a decorator</span>
<span class="sd">    so that child schedules do not depend on future time shifting.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_from_timestamp_decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">_from_timestamp_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_timestamp_contextmanager</span><span class="p">(</span><span class="n">ts</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_from_timestamp_wrapper</span>

    <span class="k">return</span> <span class="n">_from_timestamp_decorator</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>


  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Home
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.bd41221c.min.js"></script>
      
    
  </body>
</html>